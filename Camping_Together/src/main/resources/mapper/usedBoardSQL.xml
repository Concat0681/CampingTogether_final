<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="usedBoard">
	<insert id="insertUesdBoard" parameterType="ub">
		insert into used_board 
		values(
			  used_board_seq.nextval, 
			  #{usedBoardWriter}, 
			  #{usedBoardTitle}, 
			  #{usedBoardContent}, 
			  #{usedBoardCategory}, 
			  0, 
			  #{usedProductStatus}, 
			  #{exchangeStatus}, 
			  #{usedProductPrice},
			  0, 
			  #{usedTradeLocation}, 
			  0, 
			  to_char(sysdate, 'yyyy-mm-dd')
			  )
		<selectKey resultType="_int" order="AFTER" keyProperty="usedBoardNo">
				<!-- order:insert문 이후에 실행, keyProperty: boardNo변수에 넣어줄것 -->
				select max(used_board_no) from used_board
		</selectKey>
	</insert>
	<insert id="insertUesdPhoto" parameterType="ubp">
		insert into used_photo 
		values(used_file_seq.nextval, #{usedBoardNo}, #{filepath})
	</insert>
	<select id="selectUsedBoardList" parameterType="map" resultType="ub">
		select *
		from
		    (select rownum as rnum, ub.* from 
		        (select 
		            used_board.used_board_no as usedBoardNo,
		            used_board_title as usedBoardTitle,
		            used_board_status as usedBoardStatus,
		            used_product_price as usedProductPrice,
		            used_trade_location as usedTradeLocation,
		            read_count as readCount,
		            reg_date as regDate,
		            filepath as thumbnail
		        from used_board 
		        left join (select used_board.used_board_no, max(filepath) as filepath from used_board left join used_photo on used_board.used_board_no = used_photo.used_board_no group by used_board.used_board_no)B
		        on used_board.used_board_no = B.used_board_no
		        order by 1 desc)ub)
		where rnum between #{start} and #{end}
	</select>
	<select id="totalCount" resultType="_int">
		select count(*) from used_board
	</select>
	<update id="updateReadCount" parameterType="_int">
		update used_board set read_count = read_count + 1 where used_board_no = #{_parameter}
	</update>
	<select id="selectOneUsedBoard" parameterType="_int" resultType="ub">
		select 
			used_board_no as usedBoardNo,
			used_board_writer as usedBoardWriter,
			used_Board_Title as usedBoardTitle,
			used_board_content as usedBoardContent,
			used_board_category as usedBoardCategory,
			used_board_status as usedBoardStatus,
			used_product_status as usedProductStatus,
			exchange_status as exchangeStatus,
			used_product_price as usedProductPrice,
			used_delivery_status as usedDeliveryStatus,
			used_trade_location as usedTradeLocation,
			read_count as readCount,
			reg_date as regDate
		from used_board
		where used_board_no = #{_parameter}
	</select>
	
	<select id="selectUsedPhoto" parameterType="_int" resultType="ubp">
		select
			filepath as filepath
		from used_photo
		where used_board_no = #{_parameter}
	</select>
	
	<insert id="insertUsedBoardComment" parameterType="ubc">
		insert into used_board_comment values(used_board_comment_seq.nextval, #{usedBoardNo}, #{usedBoardCommentWriter}, #{usedBoardCommnetContent}, to_char(sysdate, 'yyyy-mm-dd'))
	</insert>
	
	<select id="selectCommentList" parameterType="_int" resultType="ubc">
		select 
			used_board_comment_no as usedBoardCommentNo,
			used_board_no as usedBoardNo,
			used_board_comment_writer as usedBoardCommentWriter,
			used_board_comment_content as usedBoardCommnetContent,
			reg_date as regDate
		from used_board_comment
		where used_board_no = #{_parameter}
	</select>
</mapper>









