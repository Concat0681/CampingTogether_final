<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardFood">
	<select id="selectFoodList" parameterType="map" resultType="bf">
		select * from
			(select rownum as rnum, n.*from
				(select
					board_food_no as boardFoodNo,
					board_food_writer as boardFoodWriter,
					board_food_title as boardFoodTitle,
					board_food_content as boardFoodContent,
					read_count as readCount,
					enroll_date as enrollDate,
                    filepath
				from board_food left join file_tbl using(board_food_no) order by 1 desc)n) 
		where rnum between #{start} and #{end}
	</select>
	<select id="totalCount" resultType="_int">
		select count(*) from board_food
	</select>
	
	<insert id="insertBoardFood" parameterType="bf">
		insert into board_food values(board_food_seq.nextval,#{boardFoodWriter}, #{boardFoodTitle}, #{boardFoodContent},0,to_char(sysdate, 'yyyy-mm-dd'))
		<!-- 키 값을 조회하기 위해 사용 -->
		<selectKey resultType="_int" order="AFTER" keyProperty="boardFoodNo">
		select max(board_food_no) from board_food
		</selectKey>
	</insert>
	<insert id="insertFile" parameterType="f">
		insert into file_tbl values(file_tbl_seq.nextval, #{boardFoodNo}, #{filepath})
	</insert>
	<update id="updateReadCount" parameterType="bf">
		update board_food set read_count = read_count+1 where board_food_no = #{_parameter}
	</update>
	<select id="selectOneBoardFood" parameterType="_int" resultType="bfvd" >
		select * from board_food where board_food_no = #{_parameter}
	</select>
	<select id="selectFoodComment" parameterType="bfvd" resultType="bfvd">
		select * from food_comment where board_food_ref = #{boardFoodNo} and food_comment_ref is null order by 1
	</select>
	<select id="selectReCommentList" parameterType="bfvd" resultType="bfvd">
	select * from food_comment where board_food_ref = #{boardFoodNo} and food_comment_ref is not null order by 1
	</select>
</mapper>
